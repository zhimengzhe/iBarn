<? # #°æÈ¨ËùÓÐ@·­°æ±Ø¾¿ # ?><?php class _RLMS_ef163213f51208132130f0f0bb8306921a2ddc extends Abst { public function _RLMS_176c97e7c5e6e0224595bb9b126f88099ce888() { $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2 = trim(self::trimSpace(rawurldecode($_REQUEST['path'])), '/'); $search = self::trimSpace(rawurldecode($_REQUEST['search'])); $fac = Factory::getInstance(); $order = $_REQUEST['order']; $by = $_REQUEST['by'] == 'asc' ? 'asc' : 'desc'; $_RLMS_ad9c3dd544d7be2a96e551a189eb69cd06d373e33ba37ce6c2d6f91f1b582d334139 = $_REQUEST['type']; $class = $_REQUEST['class']; $_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373 = max($_REQUEST['curPage'], 1); $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82 = $_REQUEST['perPage'] ? (int)$_REQUEST['perPage'] : 60; if ($order == 'ctime') { $order = 'time'; } if (trim($search) != '') { $list = $fac->search($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $search, $order, $by, $_RLMS_ad9c3dd544d7be2a96e551a189eb69cd06d373e33ba37ce6c2d6f91f1b582d334139, $class, $_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373, $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82); $num = $fac->searchNum($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $search, $_RLMS_ad9c3dd544d7be2a96e551a189eb69cd06d373e33ba37ce6c2d6f91f1b582d334139, $class); } else { if ($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2) { $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2info = explode('/', trim($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2, '/')); $num = count($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2info); $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 = $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2info[$num - 1]; if (!empty($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2info)) { $pid = 0; foreach ($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2info as $k => $v) { if ($k == $num - 1) { break; } $mapinfo = $fac->getFileMapByName($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $pid, $v); $pid = $mapinfo['id']; } } $mapinfo = $fac->getFileMapByName($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $pid, $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4); $id = (int)$mapinfo['id']; } else { $id = 0; } if (!$class) { $list = $fac->getDirList($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $id, $order, $by, $_RLMS_ad9c3dd544d7be2a96e551a189eb69cd06d373e33ba37ce6c2d6f91f1b582d334139, $_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373, $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82); $num = $fac->getDirNum($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $id, $_RLMS_ad9c3dd544d7be2a96e551a189eb69cd06d373e33ba37ce6c2d6f91f1b582d334139); } elseif ($class == 'recycle') { $list = $fac->getRecyList($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $order, $by, $_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373, $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82); $num = $fac->getRecyNum($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $id); } } if ($list) { $fileIocn = json_decode(ICON, true); foreach ($list as $x => $y) { $icon = $fileIocn[pathinfo($y['name'], PATHINFO_EXTENSION)]; if (!$y['isdir']) { $list[$x]['size'] = self::formatBytes($y['size']); $list[$x]['icon'] = $icon ? $icon : $fileIocn['default']; $list[$x]['bicon'] = trim(strrchr($list[$x]['icon'], ' ')); } else { $list[$x]['size'] = 0; $list[$x]['icon'] = $fileIocn['folder']; $list[$x]['bicon'] = 'folder'; } if (!$class) { $shareInfo = $fac->isShare($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $y['id']); if ($shareInfo) { $list[$x]['share'] = 1; } else { $list[$x]['share'] = 0; } } } } if (!$_REQUEST['res']) { $page = ceil($num/$_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82); $userinfo = Factory::getInstance('user')->getUserInfo($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0); $total = count($list); if (!$class) { if ($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2) { $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2s = explode('/', trim($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2, '/')); array_pop($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2s); $prePath = implode('/', $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2s); } include VIEW_PATH . '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php'; } elseif ($class == 'recycle') { include VIEW_PATH . 'recycle.php'; } } else { $html = ''; if ($list) { foreach ((array)$list as $l) { $html .= $this->_RLMS_37f00e62387bef85bc93d5e2846531fdbd19838872a4($l); } } echo $html; } } protected function _RLMS_37f00e62387bef85bc93d5e2846531fdbd19838872a4($info = array()) { if ($info['isdir']) { $href = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?path=' . (trim($_REQUEST['path'], '/') ? trim($_REQUEST['path'], '/') . '/' : '') . htmlspecialchars($info['name'], ENT_NOQUOTES); $d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8 = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=md_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8&ids=' . $info['id']; } else { if ($info['type'] == 2) { $href = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=_RLMS_010ec2dfb315381cf74944e4b96b0a936654c7411e4f62b97a75bd6e209dc0649352333a431c2d7f4f4f6a66f86c5dd2d56eb9d6be2870&urlkey=' . base_convert($info['id'], 10, 36); $data = 'data-lightbox="roadtrip"'; } else { $href = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8&urlkey=' . base_convert($info['id'], 10, 36); } $d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8 = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8&id=' . $info['id']; } if (!$info['icon']) { $fileIocn = json_decode(ICON, true); if (!$info['isdir']) { $icon = $fileIocn[pathinfo($info['name'], PATHINFO_EXTENSION)]; $info['icon'] = $icon ? $icon : $fileIocn['default']; } else { $info['icon'] = $fileIocn['folder']; } } if ($info['share']) { $share = '<div class="shareFd"></div>'; } return '<li id="li_' . $info['id'] . '"><div class="listTableIn pull-left" onmouseenter="$(\'#box_' . $info['id'] . '\').show();" onmouseleave="$(\'#box_' . $info['id'] . '\').hide();"><div class="listTableInL pull-left"><div class="cBox"><input name="classLists" type="checkbox" value="' . $info['id'] . '"></div><div class="name">' . $share . ' <em class="' . $info['icon'] . '"></em><span class="div_pro"><a target="_self" ' . $data . ' href="'. $href . '" id="a_' . $info['id']. '">' . htmlspecialchars($info['name'], ENT_NOQUOTES) . '</a></span></div></div><div class="listTableInR pull-right"><div class="size">' . $info['size'] . '</div><div class="updateTime">' . $info['time'] . '</div><div style="display:none;" class="float_box" id="box_' . $info['id'] . '"><ul class="control"><li><a href="' . $d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8 . '"><i class="icon-d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8load-alt"></i></a></li><li><a href="#" onclick="modalShare(' . $info['id'] . ', \'' . base_convert($info['id'], 10, 36) . '\');" data-toggle="modal"><i class="icon-share"></i></a></li><li><a href="#" onclick="modalName(' . $info['id'] . ', \'' . htmlspecialchars($info['name'], ENT_NOQUOTES) . '\')" data-toggle="modal"><i class="icon-edit"></i></a></li><li><a href="#" onclick="modalTrans();" data-toggle="modal"><i class="icon-random"></i></a></li><li><a href="#" onclick="modalDel(\'' . htmlspecialchars($info['name'], ENT_NOQUOTES) . '\')" data-toggle="modal"><i class="icon-remove"></i></a></li></ul></div></div></div></li>'; } public function _RLMS_3d79715fd05c64844803f566695a7759bd19838872a4906315($info = array()) { if ($info['isdir']) { $href = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?path=' . (trim($_REQUEST['path'], '/') ? trim($_REQUEST['path'], '/') . '/' : '') . htmlspecialchars($info['name'], ENT_NOQUOTES); } else { if ($info['type'] == 2) { $href = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=_RLMS_010ec2dfb315381cf74944e4b96b0a936654c7411e4f62b97a75bd6e209dc0649352333a431c2d7f4f4f6a66f86c5dd2d56eb9d6be2870&urlkey=' . base_convert($info['id'], 10, 36); $data = 'data-lightbox="roadtrip"'; } else { $href = '_RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8&urlkey=' . base_convert($info['id'], 10, 36); } } if (!$info['bicon']) { $fileIcon = json_decode(ICON, true); $icon = $fileIcon[pathinfo($info['name'], PATHINFO_EXTENSION)]; if (!$info['isdir']) { $icon = $icon ? $icon : $fileIcon['default']; $info['bicon'] = trim(strrchr($icon, ' ')); } else { $info['bicon'] = 'folder'; } } if ($info['share']) { $share = '<div class="shareFdBig"></div>'; } return '<li onmouseenter="$(\'#checkShow' . $info['id'] . '\').show();$(this).attr(\'class\', \'in\')" onmouseleave="if($(\'#squaredFour' . $info['id'] . '\').prop(\'checked\') == false) {$(\'#checkShow' . $info['id'] . '\').hide();$(this).removeClass(\'in\');}" id="bli_' . $info['id'] . '"><div class="squaredFour" id="checkShow' . $info['id'] . '"><input type="checkbox" id="squaredFour' . $info['id'] . '" name="squaredCheckbox" class="squaredCheckbox" value="' . $info['id'] . '"/><label for="squaredFour' . $info['id'] . '"></label></div><a target="_self" ' . $data . ' href="'. $href . '" id="ba_' . $info['id'] . '"><div class="big ' . $info['bicon'] . 'Big">' . $share . '</div><p>' . htmlspecialchars(mb_substr($info['name'], 0, 12, 'utf8'), ENT_NOQUOTES) . '</p><input type="hidden" id="aname_' . $info['id'] . '" value="' . htmlspecialchars($info['name'], ENT_NOQUOTES) . '"></a></li>'; } public function _RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8() { if ($_REQUEST['urlkey']) { $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = base_convert($_REQUEST['urlkey'], 36, 10); } else { $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = (int)$_REQUEST['id']; } if (!$_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794) { include VIEW_PATH . 'error.php'; exit; } $mapInfo = Factory::getInstance()->getFileMap($_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794); $shareInfo = Factory::getInstance()->getShareByMap($_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794); $shareInfo = $shareInfo[0]; if ($_REQUEST['uid']) { $userinfo = Factory::getInstance('user')->getUserInfo((int)$_REQUEST['uid']); } if (!$shareInfo) { include VIEW_PATH . 'error.php'; exit; } if (strtotime($shareInfo['overTime']) < time() && $shareInfo['overTime'] != '0000-00-00 00:00:00') { include VIEW_PATH . 'error.php'; exit; } if ($shareInfo['pwd'] && !$_SESSION['share'][self::getClientIp() . ':' . $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794] && $_REQUEST['uid'] != $mapInfo['uid']) { include VIEW_PATH . 'pwd.php'; } else { $_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373 = max($_REQUEST['curPage'], 1); $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82 = $_REQUEST['perPage'] ? (int)$_REQUEST['perPage'] : 100; if ($_REQUEST['pid']) { $pid = (int)$_REQUEST['pid']; if ($pid != $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794) { $info = Factory::getInstance()->getFileMap($pid); if (strpos($info['path'], $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794) === false) { include VIEW_PATH . 'error.php'; exit; } } $list = Factory::getInstance()->getDirList($mapInfo['uid'], $pid, '', '', 0, $_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373, $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82); } elseif ($mapInfo && $mapInfo['isdir']) { $list[0] = $mapInfo; } $fileIcon = json_decode(ICON, true); if ($list) { foreach ($list as $x => $y) { $icon = $fileIcon[pathinfo($y['name'], PATHINFO_EXTENSION)]; if (!$y['isdir']) { $list[$x]['icon'] = $icon ? $icon : $fileIcon['default']; $list[$x]['bicon'] = trim(strrchr($list[$x]['icon'], ' ')); } else { $list[$x]['bicon'] = 'folder'; } } } else { $icon = $fileIcon[pathinfo($mapInfo['name'], PATHINFO_EXTENSION)]; $icon = $icon ? $icon : $fileIcon['default']; $mapInfo['bicon'] = trim(strrchr($icon, ' ')); } include VIEW_PATH . '_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8.php'; } } public function _RLMS_a8de89d96047518c319208c98eee50cc0120a4df3d7729c9178aa4b5b5b8ba() { $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $pid = (int)$_REQUEST['pid']; $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 = self::trimSpace($_REQUEST['name']); $res = Factory::getInstance()->getFileMapByName($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $pid, $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4); echo Response::json(SUCC, $res); } public function upload() { if (!$_REQUEST['uid']) { echo Response::json(LACK, array('ç”¨æˆ·IDä¸èƒ½ä¸ºç©º')); exit; } $_REQUEST['name'] = self::filterName(rawurldecode(self::trimSpace($_REQUEST['name']))); if (!$_REQUEST['name']) { echo Response::json(LACK, array('æ–‡ä»¶åä¸èƒ½ä¸ºç©º')); exit; } if (!$_REQUEST['type']) { if (!file_exists(DATA_DIR)) { $res = mkdir(DATA_DIR, 0777, true); if (!$res) { echo Response::json(FAIL, array('å­˜å‚¨ç›®å½•åˆ›å»ºå¤±è´¥')); exit; } } } if (!file_exists(UP_DIR)) { $res = mkdir(UP_DIR, 0777, true); if (!$res) { echo Response::json(FAIL, array('å­˜å‚¨ç›®å½•åˆ›å»ºå¤±è´¥')); exit; } } include LIB_PATH . 'plupload' . DS . 'PluploadHandler.php'; PluploadHandler::no_cache_headers(); PluploadHandler::cors_headers(); if (!PluploadHandler::handle(array( 'target_dir' => UP_DIR, ))) { echo Response::json(FAIL, array('æ–‡ä»¶ä¸Šä¼ å¤±è´¥')); exit; } else { echo Response::json(SUCC, array('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ')); } } public function _RLMS_cae581d71c3669271fc753106992b7c8ec6ef26fa071ba1a1d761f310e0d18599884() { if (!$_REQUEST['uid']) { echo Response::json(LACK, array('ç”¨æˆ·IDä¸èƒ½ä¸ºç©º')); exit; } $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 = isset($_REQUEST['name']) ? self::filterName(self::trimSpace(rawurldecode($_REQUEST['name']))) : self::filterName(self::trimSpace($_FILES['file']['name'])); if (!$_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4) { echo Response::json(LACK, array('æ–‡ä»¶åä¸èƒ½ä¸ºç©º')); exit; } $hash = $_REQUEST['hash']; if (!$hash) { echo Response::json(LACK, array('hashä¸ºå¿…å¡«å‚æ•°')); exit; } $size = (int)$_REQUEST['size']; if (!$size) { $size = $_FILES['file']['size']; } $mime = $_REQUEST['mime']; if ($_FILES["file"]["type"] && !$mime) { $mime = $_FILES["file"]["type"]; } $exist = Factory::getInstance()->_RLMS_2eddbaa936cb2ad73ff25ac4bd2062e3e4774c0c1f4f4fd0baef4bf6318eb07394f1d3a82fba040c($hash, $size); if ($exist) { $filePath = $exist; } else { $filePath = UP_DIR . $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4; if (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN') { $filePath = iconv('utf-8', 'gbk exit; } } if ($fileCount > 0) { for ($i = 0; $i < $fileCount; $i++) { if (!file_exists(UP_DIR . $fileName . ".dir.part" . DS . $i)) { $hcouns = $i * $size; break; } } } echo Response::json(SUCC, array($hcouns)); } public function _RLMS_db9939dc672ca29000a6a5f33c42c3e28a8bb72e764a98d8acbf678af1a47adeb0ee9ba27be8b4ed966a93() { $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 = self::filterName(self::trimSpace(rawurldecode($_REQUEST['name']))); $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2 = self::filterPath(self::trimSpace(rawurldecode($_REQUEST['path']))); $origin = isset($_REQUEST['origin']) ? $_REQUEST['origin'] : 'os'; $cover = $_REQUEST['cover'] ? 1 : 0; if (!$_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0) { echo Response::json(LACK, array('ç”¨æˆ·IDä¸èƒ½ä¸ºç©º')); exit; } if (!$_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4) { echo Response::json(LACK, array('æ–‡ä»¶å¤¹åä¸èƒ½ä¸ºç©º')); exit; } if (strlen($_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4) > 200) { echo Response::json(FORB, array('æ–‡ä»¶å¤¹åä¸èƒ½è¶…è¿‡200ä¸ªå­—ç¬¦')); exit; } $res = Factory::getInstance()->_RLMS_db9939dc672ca29000a6a5f33c42c3e28a8bb72e764a98d8acbf678af1a47adeb0ee9ba27be8b4ed966a93($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2, $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4, $origin, $cover); if (!$cover && $res == 3) { echo Response::json(FORB, array('åŒåæ–‡ä»¶å¤¹å·²å­˜åœ¨')); exit; } if ($res == 2) { echo Response::json(FORB, array('ç›®å½•å±‚çº§è¿‡å¤šï¼Œè¶…è¿‡é™åˆ¶')); } elseif ($res && is_array($res)) { if ($_REQUEST['type']) { $res = $this->_RLMS_3d79715fd05c64844803f566695a7759bd19838872a4906315($res); } else { $res = $this->_RLMS_37f00e62387bef85bc93d5e2846531fdbd19838872a4($res); } echo Response::json(SUCC, array($res)); } else { echo Response::json(FAIL, array('åˆ›å»ºå¤±è´¥')); } } public function _RLMS_d1976603c841212f4b70e5996243a91a8ddf87b656183794e256ad9e35ad28d93d64ee1998d571241f1437e4ce67() { $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = (int)$_REQUEST['id']; $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 = self::filterName(self::trimSpace(rawurldecode($_REQUEST['name']))); $aname = self::filterName(self::trimSpace(rawurldecode($_REQUEST['aname']))); $ext = pathinfo($aname, PATHINFO_EXTENSION); if (!$_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 || trim($_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4) == '') { echo Response::json(LACK, array('ç¼ºå°‘å‚æ•°')); exit; } $res = Factory::getInstance()->_RLMS_d1976603c841212f4b70e5996243a91a8ddf87b656183794e256ad9e35ad28d93d64ee1998d571241f1437e4ce67($_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794, $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 . ($ext ? '.' . $ext : '')); if ($res == 2) { echo Response::json(FORB, array('åŒåæ–‡ä»¶å·²å­˜åœ¨')); } elseif ($res == 1) { echo Response::json(SUCC, array($_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 . ($ext ? '.' . $ext : ''))); } else { echo Response::json(FAIL, array('ä¿®æ”¹å¤±è´¥')); } } public function _RLMS_9a222f7f7e545379e36c61b9934f94ad9948c695cfeb4250762dbb2e75f5bfd8c57e28a2994001ed1c6828f853a45a611d() { $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = $_REQUEST['ids']; if (!$_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 || !$_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0) { echo Response::json(LACK, array('ç¼ºå°‘å‚æ•°')); exit; } $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794s = explode(',', $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794); if ($_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794s) { $fac = Factory::getInstance(); foreach ($_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794s as $m) { $mapinfo = $fac->getFileMap($m); $res = $fac->_RLMS_9a222f7f7e545379e36c61b9934f94ad9948c695cfeb4250762dbb2e75f5bfd8c57e28a2994001ed1c6828f853a45a611d($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $m); if ($res == 1) { $fac->recycle($mapinfo); if ($mapinfo['isdir']) { $info = $fac->getFileMapByPid($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $m); if ($info) { $ids= ''; foreach ((array)$info as $v) { $v['status'] = 1; $fac->recycle($v); $ids .= $v['id'] . ','; } $res = $fac->_RLMS_9a222f7f7e545379e36c61b9934f94ad9948c695cfeb4250762dbb2e75f5bfd8c57e28a2994001ed1c6828f853a45a611d($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, trim($ids, ',')); if ($res) { $fac->unShareByMapId(trim($ids, ',')); $fac->unCollectByMapId(trim($ids, ',')); } } } } } } if ($res) { echo Response::json(SUCC, array('åˆ é™¤æˆåŠŸ')); } else { echo Response::json(FAIL, array('åˆ é™¤å¤±è´¥')); } } public function _RLMS_7e2abe7550dabb0dc831f6f33e534ff29948c695cfeb425076ea00cf72056a3aa732a04a8f5ea57f1bca2f1e5e9f79893f3325a3() { $ids = $_REQUEST['ids']; $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $res = Factory::getInstance()->_RLMS_7e2abe7550dabb0dc831f6f33e534ff29948c695cfeb425076ea00cf72056a3aa732a04a8f5ea57f1bca2f1e5e9f79893f3325a3($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $ids); if ($res) { echo Response::json(SUCC, array('åˆ é™¤æˆåŠŸ')); } else { echo Response::json(FAIL, array('åˆ é™¤å¤±è´¥')); } } public function recover() { $ids = explode(',', $_REQUEST['ids']); $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; if ($ids) { $fac = Factory::getInstance(); foreach ($ids as $v) { $res = $fac->recover($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, (int)$v); if ($res) { $fac->_RLMS_7e2abe7550dabb0dc831f6f33e534ff29948c695cfeb425076ea00cf72056a3aa732a04a8f5ea57f1bca2f1e5e9f79893f3325a3($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, (int)$v); } } } if ($res) { echo Response::json(SUCC, array('è¿˜åŽŸæˆåŠŸ')); } else { echo Response::json(FAIL, array('è¿˜åŽŸå¤±è´¥')); } } public function move() { $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $smapId = $_REQUEST['smapId']; $dmapId = (int)$_REQUEST['dmapId']; $dpath = self::trimSpace($_REQUEST['dpath']); $cover = (int)$_REQUEST['cover']; if (!$_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 || !$smapId) { echo Response::json(LACK, array('ç¼ºå°‘å‚æ•°')); exit; } $sid = explode(',', $smapId); if ($sid) { foreach ($sid as $s) { $res = Factory::getInstance()->move($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $s, $dmapId, $dpath, $cover); } } if ($res == 1) { echo Response::json(SUCC, array('ç§»åŠ¨æˆåŠŸ')); } elseif ($res == 2) { echo Response::json(FORB, array('æ²¡æœ‰ç§»åŠ¨')); } else { echo Response::json(FAIL, array('ç§»åŠ¨å¤±è´¥')); } } public function duplicate() { $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $smapId = (int)$_REQUEST['smapId']; $dmapId = (int)$_REQUEST['dmapId']; $dpath = self::trimSpace($_REQUEST['dpath']); $cover = (int)$_REQUEST['cover']; if (!$_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 || !$smapId || !$dmapId) { echo Response::json(LACK, array('ç¼ºå°‘å‚æ•°')); exit; } $res = Factory::getInstance()->duplicate($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0, $smapId, $dmapId, $dpath, $cover); if ($res == 1) { echo Response::json(SUCC, array('å¤åˆ¶æˆåŠŸ')); } else { echo Response::json(FAIL, array('å¤åˆ¶å¤±è´¥')); } } public function _RLMS_010ec2dfb315381cf74944e4b96b0a936654c7411e4f62b97a75bd6e209dc0649352333a431c2d7f4f4f6a66f86c5dd2d56eb9d6be2870() { set_time_limit(60); $urlkey = $_REQUEST['urlkey']; if (!$urlkey) { $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = (int)$_REQUEST['id']; if (!$_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794) { echo Response::json(LACK, array('ç¼ºå°‘å‚æ•°')); exit; } } else { $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = base_convert($urlkey, 36, 10); } $fac = Factory::getInstance(); $info = $fac->getFileMap($_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794); if (!$info['location'] && !$info['isdir']) { include VIEW_PATH . 'error.php'; exit; } if ($_SESSION['CLOUD_UID'] != $info['uid']) { $pids = str_replace('/', ',', trim($info['path'], '/')); $ids = ($pids ? $pids . ',' : '') . $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794; $shares = $fac->getShareByMap($ids); if ($shares) { $keys = array(); foreach ($shares as $v) { $keys[$v['mapId']] = $v['mapId']; $shares[$v['mapId']] = $v; } $shareInfo = $shares[max($keys)]; } else { include VIEW_PATH . 'error.php'; exit; } if ($shareInfo) { if (strtotime($shareInfo['overTime']) < time() && $shareInfo['overTime'] != '0000-00-00 00:00:00') { include VIEW_PATH . 'error.php'; exit; } $fac->incrShareView($shareInfo['id']); if ($info['isdir'] || ($shareInfo['pwd'] && !$_SESSION['share'][self::getClientIp() . ':' . $shareInfo['mapId']])) { include VIEW_PATH . 'error.php'; exit; } } else { include VIEW_PATH . 'error.php'; exit; } } elseif ($info['isdir']) { if ($urlkey) { header('Location: _RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8&urlkey=' . $urlkey); } else { header('Location: _RLMS_176c97e7c5e6e0224595bb9b126f88099ce888.php?a=_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8&id=' . $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794); } exit; } if (!$_REQUEST['type']) { header('Content-type: ' . ($info['mime'] ? $info['mime'] : 'application/octet-stream')); readfile($info['location']); } else { } } public function d_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8() { set_time_limit(2 * 3600); $urlkey = $_REQUEST['urlkey']; if (!$urlkey) { $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = (int)$_REQUEST['id']; if (!$_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794) { echo Response::json(LACK, array('ç¼ºå°‘å‚æ•°')); exit; } } else { $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794 = base_convert($urlkey, 36, 10); } $fac = Factory::getInstance(); $info = $fac->getFileMap($_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794); if (!$info['location']) { include VIEW_PATH . 'error.php'; exit; } if ($_SESSION['CLOUD_UID'] != $info['uid']) { $pids = str_replace('/', ',', trim($info['path'], '/')); $ids = ($pids ? $pids . ',' : '') . $_RLMS_665867fdfaa9b863c72cfa4113daf0a206d3732a3691e9998d2db6ab74aa309e58f802e794; $shares = $fac->getShareByMap($ids); if ($shares) { $keys = array(); foreach ($shares as $v) { $keys[$v['mapId']] = $v['mapId']; $shares[$v['mapId']] = $v; } $shareInfo = $shares[max($keys)]; } else { include VIEW_PATH . 'error.php'; exit; } if ($shareInfo) { if (strtotime($shareInfo['overTime']) < time() && $shareInfo['overTime'] != '0000-00-00 00:00:00') { include VIEW_PATH . 'error.php'; exit; } $fac->incrShareD_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8($shareInfo['id']); if ($info['isdir'] || ($shareInfo['pwd'] && !$_SESSION['share'][self::getClientIp() . ':' . $shareInfo['mapId']])) { include VIEW_PATH . 'error.php'; exit; } } else { include VIEW_PATH . 'error.php'; exit; } } $url = parse_url(trim($info['name'], '/')); $_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2Array = explode('/', $url['path']); $fileName = end($_RLMS_7885a56e0cc8df63068c4e29d429227906d37327ec8279f5bad995356504e2Array); if (!$fileName) { $fileName = 'sorry.' . pathinfo($url['path'], PATHINFO_EXTENSION); } $fsize = (int)$info['size']; if (!empty($fsize)) { $start = null; $end = $fsize - 1; if (isset($_SERVER['HTTP_RANGE']) && ($_SERVER['HTTP_RANGE'] != "") && preg_match("/^bytes=([0-9]+)-([0-9]*)$/i", $_SERVER['HTTP_RANGE'], $match) && ($match[1] < $fsize) && ($match[2] < $fsize)) { $start = $match[1]; if (!empty($match[2]))$end = $match[2]; } header("Cache-control: public"); header("Pragma: public"); if ($start === null) { header("HTTP/1.1 200 OK"); header("Content-Length: $fsize"); header("Accept-Ranges: bytes"); } else { header("HTTP/1.1 206 Partial Content"); header("Content-Length: " . ($end - $start + 1)); header("Content-Ranges: bytes " . $start . "-" . $end . "/" . $fsize); } header('Content-type: ' . ($info['mime'] ? $info['mime'] : 'application/octet-stream')); if (preg_match("/MSIE/", $_SERVER["HTTP_USER_AGENT"])) { header('Content-Disposition: attachment; filename="' . rawurlencode($fileName) . '"'); } else if (preg_match("/Firefox/", $_SERVER["HTTP_USER_AGENT"])) { header('Content-Disposition: attachment; filename*="utf8\'\'' . $fileName . '"'); } else { header('Content-Disposition: attachment; filename="' . $fileName . '"'); } ob_clean(); flush(); session_write_close(); if (!$_REQUEST['type']) { $fp = fopen($info['location'], "rb"); fseek($fp, $start); $chunk = 1024 * 1024; while(($nowNum = ftell($fp)) < $end){ if ($nowNum >= ($end - $chunk)) { $chunk = $end - $nowNum + 1; } echo fread($fp, $chunk); sleep(2); } fclose($fp); exit(); } else { } }else { header("HTTP/1.1 404 Not Found"); header('Content-Type: text/html; charset=utf-8'); } } public function md_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8() { if (!extension_loaded('zip')) { include VIEW_PATH . 'error.php'; exit; } set_time_limit(2 * 3600); $fac = Factory::getInstance(); $ids = $_REQUEST['ids']; $info = $fac->getFileMap($ids); if (is_numeric($ids)) { $tmp = $info; unset($info); $info[0] = $tmp; } if ($info) { foreach ($info as $v) { if ($_SESSION['CLOUD_UID'] != $v['uid']) { $pids = str_replace('/', ',', trim($v['path'], '/')); $ids = ($pids ? $pids . ',' : '') . $v['id']; $shares = $fac->getShareByMap($ids); if ($shares) { $keys = array(); foreach ($shares as $y) { $keys[$y['mapId']] = $y['mapId']; $shares[$y['mapId']] = $y; } $shareInfo = $shares[max($keys)]; } else { continue; } if ($shareInfo) { if (strtotime($shareInfo['overTime']) < time() && $shareInfo['overTime'] != '0000-00-00 00:00:00') { continue; } $fac->incrShareD_RLMS_0823722c7df512564212164703f1e3c9f1584b437639329e65585fc8($shareInfo['id']); if ($shareInfo['pwd'] && !$_SESSION['share'][self::getClientIp() . ':' . $shareInfo['mapId']]) { continue; } } else { continue; } } if ($v['isdir']) { $list = $fac->getFileMapByPid($v['uid'], $v['id'], 1); if ($list) { foreach ($list as $y) { $dirs[] = $y['location']; } } } else { $dirs[] = $v['location']; } } } else { include VIEW_PATH . 'error.php'; exit; } $zip = new zipArchive(); $zipName = md5(uniqid() . time()) . '.zip'; $zip->open($zipName, ZIPARCHIVE::OVERWRITE); foreach ($dirs as $v) { $zip->addFile($v, basename($v)); } $zip->close(); header('Content-Type:Application/zip'); if (preg_match("/MSIE/", $_SERVER["HTTP_USER_AGENT"])) { header('Content-Disposition: attachment; filename="' . rawurlencode($zipName) . '"'); } else if (preg_match("/Firefox/", $_SERVER["HTTP_USER_AGENT"])) { header('Content-Disposition: attachment; filename*="utf8\'\'' . $zipName . '"'); } else { header('Content-Disposition: attachment; filename="' . $zipName . '"'); } header('Content-Length:' . filesize($zipName)); ob_clean(); flush(); session_write_close(); readfile($zipName); unlink($zipName); } public function setUpload() { $size = (int)$_REQUEST['size']; $str = "<?php ini_set('post_max_size', '" . $size . "M'); ini_set('upload_max_filesize','" . ($size + 3) . "M'); ini_set('memory_limit','" . ($size + 3) . "M'); ?>"; file_put_contents(CONFIG_PATH . 'upload.php', $str); echo Response::json(SUCC, array('è®¾ç½®æˆåŠŸ')); } public function getTree() { $_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0 = (int)$_REQUEST['uid']; $list = Factory::getInstance()->getTree($_RLMS_efa41735a04e2460e21bf7a4403c926806d373b98b82395eae3754d0); $res = '[{"text": "æ‰€æœ‰èµ„æ–™", "mapId": "0"}]'; if ($list) { $list = $this->tree($list); $ret = array(0 => array('text' => 'æ‰€æœ‰èµ„æ–™', 'mapId' => 0)); $ret[0]['nodes'] = $list; unset($list); $res = json_encode($ret); } echo $res; } public function offer() { $_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373 = max($_REQUEST['curPage'], 1); $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82 = $_REQUEST['perPage'] ? (int)$_REQUEST['perPage'] : 100; $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4 = $_REQUEST['search']; $order = $_REQUEST['order']; $by = $_REQUEST['by'] == 'asc' ? 'asc' : 'desc'; $fac = Factory::getInstance(); $userinfo = Factory::getInstance('user')->getUserInfo($_REQUEST['uid']); $list = $fac->getOfferList($_RLMS_8ad6ecbbf0b0c1c863cd330fc0732c0f06d373, $_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82, $_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4, $order, $by); if ($list) { $fileIocn = json_decode(ICON, true); foreach ((array)$list as $k => $v) { $list[$k]['pwd'] = $v['pwd'] ? 1 : 0; $icon = $fileIocn[pathinfo($list[$k]['name'], PATHINFO_EXTENSION)]; if (!$list[$k]['isdir']) { $list[$k]['size'] = self::formatBytes($v['size']); $list[$k]['icon'] = $icon ? $icon : $fileIocn['default']; } else { $list[$k]['size'] = 0; $list[$k]['icon'] = $fileIocn['folder']; } $collecInfo = $fac->isCollect($_REQUEST['uid'], $v['id']); if ($collecInfo) { $list[$k]['collect'] = 1; } else { $list[$k]['collect'] = 0; } } } $num = $fac->getOfferNum($_RLMS_4c7b00e40971a469adfea5e8a2757a0e06d373269586e287e4); $page = ceil($num/$_RLMS_fef00e6223a607f3eaeb81f2a9d3316106d37327ec82); include VIEW_PATH . 'offer.php'; } } ?>